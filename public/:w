<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bootstrap Form Builder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        padding-bottom: 10px;
      }
      #components{
        min-height: 600px;
      }
      #target{
        min-height: 200px;
        border: 1px solid #ccc;
        padding: 5px;
      }
      #target .component{
        border: 1px solid #fff;
      }
      #temp{
        width: 500px;
        background: white;
        border: 1px dotted #ccc;
        border-radius: 10px;
      }

      .popover-content form {
        margin: 0 auto;
        width: 213px;
      }
      .popover-content form .btn{
        margin-right: 10px
      }
      #source{
        min-height: 500px;
      }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Bootstrap Form Builder</a>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row clearfix">
        <div class="span6">
          <div class="clearfix">
            <h2>Your Form</h2>
            <hr>
            <div id="build">
              <form id="target" class="form-horizontal">
                <fieldset>
                  <div id="legend" class="component" rel="popover" title="Form Title" trigger="manual"
                    data-content="
                    <form class='form'>
                      <div class='controls'>
                        <label class='control-label'>Title</label> <input class='input-large' type='text' name='title' id='text'>
                        <hr/>
                        <button class='btn btn-info'>Save</button><button class='btn btn-danger'>Cancel</button>
                      </div>
                    </form>"
                    >
                    <legend class="valtype" data-valtype="text">Form Name</legend>
                  </div>
                </fieldset>
              </form>
            </div>
          </div>
        </div>

        <div class="span6">
          <h2>Drag & Drop components</h2>
          <hr>
          <div class="tabbable">
            <form class="form-horizontal" id="components">
              <fieldset>
                <div class="tab-content">
                </div>
              </div>
              <div class="row clearfix">
                <div class="span12">
                  <hr>
                  By Adam Moore (<a href="http://twitter.com/minikomi" >@minikomi</a>).<br/>
                  Source on (<a href="http://github.com/minikomi" >Github</a>).
                </div>
              </div>
            </div> <!-- /container -->

            <!-- general js -->
            <script src="assets/js/jquery.js"></script>
            <script src="assets/js/bootstrap.js"></script>
            <script src="assets/js/bootstrap-tab.js"></script>

            <!-- backbone -->
            <script src="underscore-min.js" type="text/javascript"></script>
            <script src="backbone.js" type="text/javascript"></script>

            <!-- templates -->

            <!-- popover -->
            <script type="text/html" id="popover-input">
              <label class='control-label'> <%= label %> </label> <input class='input-large' type='text' name='<%= id %>' id='<%= id %>' value ='<%= value %>' />
            </script>

            <script type="text/html" id="popover-textarea">
              <label class='control-label'> <%= label %> </label>
              <textarea style='min-height: 200px' id='<%= id %>'>
                <% for ( var i = 0; i < options.length ; i++ ) { %><%= item + "\n" %><% } %>
              </textarea>
            </script>

            <script type="text/html" id="popover-main">
              <form class='form'>
                <div class='controls'>
                  <% for ( var i = 0; i < items.length ; i++ ) { %>
                    <%= popoverItemTemplates[items[i].type](items[i]) %>
                    <% } %>
                  <hr/>
                  <button class='btn btn-info'>Save</button><button class='btn btn-danger'>Cancel</button>
                </div>
              </form>
            </script>

            <!-- tab  -->
            <script type="text/html" id="tab-main">
              <ul class="nav nav-tabs" id="navtab">
                <li class="active"><a href="#1" data-toggle="tab">Input</a></li>
                <li class><a id="sourcetab" href="#<%= lastTab =%>" data-toggle="tab">Generated Source</a></li>
              </ul>
            </script>

            <!-- snippet -->
            <script type="text/html" id="snippet-textInput">
              <!-- Text input-->
              <label class="control-label" for="input01" data-valtype='label'><%= label %></label>
              <div class="controls">
                <input type="text" placeholder="<%= placeholder %>" class="input-xlarge" data-valtype="placeholder" >
                <p class="help-block" data-valtype='help'><%= helptext %></p>
              </div>
            </script>
              
            <script type="text/html" id="snippet-search">
              <!-- Search input-->
              <label class="control-label" data-valtype="label"><%= label %></label>
              <div class="controls">
                <input type="text" placeholder="<%= placeholder %>" class="input-xlarge search-query" data-valtype="placeholder">
                <p class="help-block" data-valtype="help"><%= helptext %></p>
              </div>
            </script>

            <script type="text/html" id="snippet-prepend">
              <!-- Prepended text-->
              <label class="control-label" data-valtype="label"><%= label %></label>
              <div class="controls">
                <div class="input-prepend">
                  <span class="add-on" data-valtype="prepend"><%= prepend %></span>
                  <input class="span2" placeholder="<%= placeholder %>" type="text" data-valtype="placeholder">
                </div>
                <p class="help-block" data-valtype="help"><%= helptext %></p>
              </div>
            </script>

            <script>
              var popoverInputTemplate = _.template($("#popover-input").html());
              var popoverTextareaTemplate = _.template($("#popover-textarea").html());
              var popoverTemplate = _.template($("#popover-main").html());
              var popoverItemTemplates = {
                "text" : popoverInputTemplate,
                "textarea" : popoverTextareaTemplate,
              }

              var Snippet  = Backbone.Model.extend({});

              var Tab = Backbone.Collection.extend({});

              var SnippetView = Backbone.View.extend({
                tagName: "div.control-group",
                model: Snippet,
                initialize: function(snippet){ console.log(this); this.template = _.template($("#snippet-"+ snippet.get("type")).html())},
                render: function(){
                  this.$el.html(this.template(
                  _.reduce(this.toJSON(), function(o, v, k){
                    if (k !== "type") { o[k] = v["value"] }
                    return o;
                  },{})
                  ))
                }

              });

              var textInput = new Snippet({
                "type"          : "textInput"
                , "label"       : {"label"    : 'Label Text'  , "type" : 'text' , "value" : 'label'}
                , "prepend"     : {"label"    : 'Prepend'     , "type" : 'text' , "value" : 'prepend'}
                , "placeholder" : {"label"    : 'Placeholder' , "type" : 'text' , "value" : 'placeholder'}
                , "help"        : {"label"    : 'Help Text'   , "type" : 'text' , "value" : 'help'}
              });
            </script>
          </body>
        </html>
